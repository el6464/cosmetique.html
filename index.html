<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Belli et Bien Être</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
body{font-family:Arial;margin:0;padding:0;background:#f5f5f5;}
header{background:#4CAF50;color:white;padding:10px;text-align:center;position:relative;}
header img{height:40px;vertical-align:middle;margin-right:10px;}
nav{padding:10px;text-align:right;}
nav span{cursor:pointer;margin-left:15px;background:#fff;padding:5px 10px;border-radius:5px;}
.container{display:flex;flex-wrap:wrap;justify-content:center;padding:20px;}
.card{background:white;width:200px;margin:10px;padding:10px;border-radius:5px;box-shadow:0 0 5px #aaa;text-align:center;}
button{padding:5px 10px;margin:5px;cursor:pointer;}
#panierBtn{position:relative;}
#panierCount{position:absolute;top:-5px;right:-10px;background:red;color:white;border-radius:50%;padding:2px 6px;font-size:12px;}
#panierWindow{position:fixed;top:60px;right:20px;width:300px;background:white;border:1px solid #ccc;padding:10px;display:none;z-index:100;}
#formClient{background:white;padding:10px;margin-top:10px;}
#adminPage{display:none;padding:20px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ccc;padding:5px;text-align:center;}
</style>
</head>
<body>

<header>
    <img src="https://via.placeholder.com/40" alt="Logo">
    BELLI ET BIEN ÊTRE
    <nav>
        <span id="panierBtn">Panier <span id="panierCount">0</span></span>
        <span id="adminBtn">Admin</span>
    </nav>
</header>

<div class="container" id="produitsContainer">
    <!-- Produits générés en JS -->
</div>

<div id="panierWindow">
    <h3>Panier</h3>
    <div id="panierItems"></div>
    <div id="formClient">
        <h4>Formulaire Client</h4>
        <input type="text" id="nom" placeholder="Nom" required><br>
        <input type="text" id="prenom" placeholder="Prénom" required><br>
        <input type="text" id="adresse" placeholder="Adresse" required><br>
        <input type="text" id="telephone" placeholder="Téléphone" required><br>
        <button id="validerCommande">Valider la commande</button>
    </div>
</div>

<div id="adminPage">
    <h2>Page Admin - Commandes</h2>
    <table>
        <thead>
            <tr>
                <th>Facture</th>
                <th>Client</th>
                <th>Téléphone</th>
                <th>Adresse</th>
                <th>Date Commande</th>
                <th>Date Livraison</th>
                <th>Mode Paiement</th>
                <th>Total (€)</th>
            </tr>
        </thead>
        <tbody id="adminTableBody">
        </tbody>
    </table>
</div>

<script>
const produits=[
    {id:1,nom:"Produit A",prix:10},
    {id:2,nom:"Produit B",prix:20},
    {id:3,nom:"Produit C",prix:15}
];

let cart=[];
let commandes=[];
let paiementChoisi="";
let donneesTemp={};

const produitsContainer=document.getElementById("produitsContainer");
const panierBtn=document.getElementById("panierBtn");
const panierWindow=document.getElementById("panierWindow");
const panierItems=document.getElementById("panierItems");
const panierCount=document.getElementById("panierCount");
const validerCommandeBtn=document.getElementById("validerCommande");
const adminBtn=document.getElementById("adminBtn");
const adminPage=document.getElementById("adminPage");
const adminTableBody=document.getElementById("adminTableBody");

// Génération des produits
produits.forEach(p=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<h4>${p.nom}</h4><p>${p.prix} €</p>
        <button onclick="ajouterAuPanier(${p.id})">Ajouter</button>`;
    produitsContainer.appendChild(card);
});

function ajouterAuPanier(id){
    const p=produits.find(pr=>pr.id===id);
    const exist=cart.find(item=>item.id===id);
    if(exist){
        exist.quantite++;
    }else{
        cart.push({...p,quantite:1});
    }
    updateCart();
}

function updateCart(){
    panierItems.innerHTML="";
    cart.forEach((item,index)=>{
        const div=document.createElement("div");
        div.innerHTML=`${item.nom} 
        <button onclick="modifierQuantite(${index},-1)">-</button>
        ${item.quantite}
        <button onclick="modifierQuantite(${index},1)">+</button>
        <button onclick="supprimerItem(${index})">Supprimer</button>
        `;
        panierItems.appendChild(div);
    });
    panierCount.textContent=cart.reduce((a,b)=>a+b.quantite,0);
}

function modifierQuantite(index,val){
    cart[index].quantite+=val;
    if(cart[index].quantite<1) cart[index].quantite=1;
    updateCart();
}

function supprimerItem(index){
    cart.splice(index,1);
    updateCart();
}

panierBtn.onclick=()=>panierWindow.style.display=(panierWindow.style.display==="none"?"block":"none");

adminBtn.onclick=()=>{
    adminPage.style.display=(adminPage.style.display==="none"?"block":"none");
    afficherAdmin();
};

validerCommandeBtn.onclick=()=>{
    if(cart.length===0){ alert("Panier vide !"); return; }

    // Récupérer données client
    donneesTemp={
        nom:document.getElementById("nom").value,
        prenom:document.getElementById("prenom").value,
        adresse:document.getElementById("adresse").value,
        telephone:document.getElementById("telephone").value,
        dateCommande:new Date().toISOString().split('T')[0],
        dateLivraison:new Date(Date.now()+3*24*60*60*1000).toISOString().split('T')[0]
    };

    // Choix du mode de paiement
    paiementChoisi=prompt("Mode de paiement : Wave / Orange Money / Espèces");
    if(!paiementChoisi) return;

    genererFacture();
};

function genererFacture(){

    const numero="FAC-"+donneesTemp.dateCommande.replaceAll("-","")+"-"+Math.floor(Math.random()*10000);
    const total=cart.reduce((a,b)=>a+b.prix*b.quantite,0);

    sauvegarderCommande({
        numeroFacture:numero,
        client:donneesTemp.nom+" "+donneesTemp.prenom,
        telephone:donneesTemp.telephone,
        adresse:donneesTemp.adresse,
        dateCommande:donneesTemp.dateCommande,
        dateLivraison:donneesTemp.dateLivraison,
        paiement:paiementChoisi,
        total
    });

    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();

    doc.setFontSize(18);
    doc.text("BELLI ET BIEN ÊTRE",20,20);

    doc.setFontSize(11);
    doc.text("Adresse : Dakar, Sénégal",20,28);
    doc.text("Téléphone : +221 77 000 00 00",20,34);

    doc.setFontSize(12);
    doc.text("Facture : "+numero,20,44);
    doc.text("Date de commande : "+donneesTemp.dateCommande,20,50);
    doc.text("Date de livraison : "+donneesTemp.dateLivraison,20,56);
    doc.text("Mode de paiement : "+paiementChoisi,20,62);

    doc.text("Client :",20,70);
    doc.text("Nom : "+donneesTemp.nom,30,76);
    doc.text("Prénom : "+donneesTemp.prenom,30,82);
    doc.text("Adresse : "+donneesTemp.adresse,30,88);
    doc.text("Téléphone : "+donneesTemp.telephone,30,94);

    doc.autoTable({
        startY:104,
        head:[["Produit","Quantité","Prix","Total"]],
        body:cart.map(p=>[
            p.nom,
            p.quantite,
            p.prix,
            (p.prix*p.quantite).toFixed(2)
        ])
    });

    doc.text("TOTAL : "+total.toFixed(2)+" €",150,doc.lastAutoTable.finalY+10);

    doc.save("facture_"+numero+".pdf");

    cart=[];
    updateCart();
    alert("Commande enregistrée !");
}

function sauvegarderCommande(cmd){
    commandes.push(cmd);
    localStorage.setItem("commandes",JSON.stringify(commandes));
}

function afficherAdmin(){
    adminTableBody.innerHTML="";
    commandes.forEach(c=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
            <td>${c.numeroFacture}</td>
            <td>${c.client}</td>
            <td>${c.telephone}</td>
            <td>${c.adresse}</td>
            <td>${c.dateCommande}</td>
            <td>${c.dateLivraison}</td>
            <td>${c.paiement}</td>
            <td>${c.total.toFixed(2)}</td>
        `;
        adminTableBody.appendChild(tr);
    });
}

// Charger commandes existantes
if(localStorage.getItem("commandes")){
    commandes=JSON.parse(localStorage.getItem("commandes"));
}
</script>

</body>
</html>
