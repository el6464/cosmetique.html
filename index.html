<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Commande en ligne</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background:#f4f4f4; }
  header { background:#333; color:#fff; padding:15px; display:flex; justify-content:space-between; align-items:center; }
  header h1 { margin:0; font-size:20px; }
  header button { background:#ff6f61; border:none; color:#fff; padding:8px 12px; cursor:pointer; border-radius:4px; }
  .container { display:flex; flex-wrap:wrap; padding:20px; gap:20px; justify-content:center; }
  .product { background:#fff; padding:15px; border-radius:8px; width:200px; box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; }
  .product img { width:100%; height:120px; object-fit:cover; border-radius:4px; }
  .product h3 { margin:10px 0 5px; font-size:16px; }
  .product p { margin:5px 0; }
  .product button { background:#28a745; color:#fff; border:none; padding:8px 12px; cursor:pointer; border-radius:4px; }
  #cart-count { background:#ff6f61; padding:2px 6px; border-radius:50%; margin-left:5px; }
  /* Modal panier */
  #cart-modal, #form-modal, #payment-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
  .modal-content { background:#fff; padding:20px; border-radius:8px; width:90%; max-width:500px; max-height:80%; overflow-y:auto; position:relative; }
  .close { position:absolute; top:10px; right:10px; cursor:pointer; font-weight:bold; font-size:18px; }
  table { width:100%; border-collapse: collapse; margin-top:10px; }
  th, td { border-bottom:1px solid #ddd; padding:8px; text-align:center; }
  .qty-btn { padding:3px 6px; margin:0 2px; cursor:pointer; border:none; background:#ccc; border-radius:3px; }
  input[type="text"], input[type="tel"], input[type="date"] { width:100%; padding:6px; margin:5px 0 10px; border-radius:4px; border:1px solid #ccc; }
  button.validate { background:#007bff; color:#fff; border:none; padding:10px; cursor:pointer; border-radius:5px; width:100%; margin-top:10px; }
</style>
</head>
<body>

<header>
  <h1>Ma Boutique</h1>
  <button id="open-cart">Panier (<span id="cart-count">0</span>)</button>
</header>

<div class="container" id="products"></div>

<!-- Modal Panier -->
<div id="cart-modal">
  <div class="modal-content">
    <span class="close" onclick="closeCart()">×</span>
    <h2>Votre Panier</h2>
    <table id="cart-table">
      <thead>
        <tr><th>Produit</th><th>Prix</th><th>Qté</th><th>Total</th><th>Suppr</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button class="validate" onclick="openForm()">Valider la commande</button>
  </div>
</div>

<!-- Modal Formulaire -->
<div id="form-modal">
  <div class="modal-content">
    <span class="close" onclick="closeForm()">×</span>
    <h2>Informations Client</h2>
    <form id="form-order">
      <input type="text" id="nom" placeholder="Nom" required>
      <input type="text" id="prenom" placeholder="Prénom" required>
      <input type="text" id="adresse" placeholder="Adresse" required>
      <input type="tel" id="telephone" placeholder="Téléphone" required>
      <input type="date" id="dateCommande" readonly>
      <input type="date" id="dateLivraison" readonly>
      <button type="submit" class="validate">Confirmer et générer facture</button>
    </form>
  </div>
</div>

<!-- Modal Paiement -->
<div id="payment-modal">
  <div class="modal-content">
    <span class="close" onclick="closePayment()">×</span>
    <h2>Choisissez votre mode de paiement</h2>
    <button onclick="payer('Wave')">Wave</button>
    <button onclick="payer('Orange Money')">Orange Money</button>
    <button onclick="payer('Espèces')">Espèces</button>
  </div>
</div>

<script>
const products = [
  {id:1, nom:'Produit A', prix:10, img:'https://via.placeholder.com/200x120'},
  {id:2, nom:'Produit B', prix:15, img:'https://via.placeholder.com/200x120'},
  {id:3, nom:'Produit C', prix:20, img:'https://via.placeholder.com/200x120'}
];
let cart = [];

// Afficher produits
const container = document.getElementById('products');
products.forEach(p => {
  const div = document.createElement('div');
  div.className='product';
  div.innerHTML = `
    <img src="${p.img}" alt="${p.nom}">
    <h3>${p.nom}</h3>
    <p>${p.prix} €</p>
    <button onclick="addToCart(${p.id})">Ajouter</button>
  `;
  container.appendChild(div);
});

// Ajouter au panier
function addToCart(id){
  const produit = products.find(p=>p.id===id);
  const exist = cart.find(p=>p.id===id);
  if(exist){ exist.quantite++; }
  else { cart.push({...produit, quantite:1}); }
  updateCart();
}

function updateCart(){
  const tbody = document.querySelector('#cart-table tbody');
  tbody.innerHTML='';
  cart.forEach(p=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.nom}</td>
      <td>${p.prix} €</td>
      <td>
        <button class="qty-btn" onclick="changeQty(${p.id},-1)">-</button>
        ${p.quantite}
        <button class="qty-btn" onclick="changeQty(${p.id},1)">+</button>
      </td>
      <td>${p.prix*p.quantite} €</td>
      <td><button onclick="removeFromCart(${p.id})">X</button></td>
    `;
    tbody.appendChild(tr);
  });
  document.getElementById('cart-count').innerText = cart.reduce((sum,p)=>sum+p.quantite,0);
}

function changeQty(id, delta){
  const item = cart.find(p=>p.id===id);
  if(item){
    item.quantite += delta;
    if(item.quantite<1) removeFromCart(id);
  }
  updateCart();
}

function removeFromCart(id){
  cart = cart.filter(p=>p.id!==id);
  updateCart();
}

// Modal panier
document.getElementById('open-cart').addEventListener('click', ()=>document.getElementById('cart-modal').style.display='flex');
function closeCart(){ document.getElementById('cart-modal').style.display='none'; }

// Modal formulaire
function openForm(){
  document.getElementById('cart-modal').style.display='none';
  document.getElementById('form-modal').style.display='flex';
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('dateCommande').value = today;
  document.getElementById('dateLivraison').value = today;
}
function closeForm(){ document.getElementById('form-modal').style.display='none'; }

// Modal paiement
function closePayment(){ document.getElementById('payment-modal').style.display='none'; }
function payer(methode){ alert(`Paiement effectué avec ${methode} !`); cart=[]; updateCart(); closePayment(); }

// Formulaire et génération facture PDF
document.getElementById('form-order').addEventListener('submit', function(e){
  e.preventDefault();
  const nom = document.getElementById('nom').value;
  const prenom = document.getElementById('prenom').value;
  const adresse = document.getElementById('adresse').value;
  const telephone = document.getElementById('telephone').value;
  const dateCommande = document.getElementById('dateCommande').value;
  const dateLivraison = document.getElementById('dateLivraison').value;

  // Générer PDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("FACTURE DE COMMANDE",20,20);
  doc.setFontSize(12);
  doc.text(`Nom : ${nom} ${prenom}`,20,40);
  doc.text(`Adresse : ${adresse}`,20,50);
  doc.text(`Téléphone : ${telephone}`,20,60);
  doc.text(`Date commande : ${dateCommande}`,20,70);
  doc.text(`Date livraison : ${dateLivraison}`,20,80);
  let y=100;
  doc.text("Produits :",20,y);
  cart.forEach((p,i)=>{
    y+=10;
    doc.text(`${i+1}. ${p.nom} - ${p.quantite} x ${p.prix} € = ${p.quantite*p.prix} €`,20,y);
  });
  y+=20;
  const total = cart.reduce((sum,p)=>sum+p.quantite*p.prix,0);
  doc.text(`Total : ${total} €`,20,y);
  doc.save("facture_commande.pdf");

  closeForm();
  document.getElementById('payment-modal').style.display='flex';
});
</script>

</body>
</html>
