<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BELLI ET BIEN ÊTRE</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Roboto;background:#f4f4f4;margin:0}
header{background:#009688;color:white;padding:15px;display:flex;justify-content:space-between}
button{cursor:pointer;border:none;padding:8px 12px;border-radius:4px}
.products{display:flex;gap:20px;flex-wrap:wrap;padding:20px}
.product{background:white;padding:15px;border-radius:8px;width:200px;text-align:center}
.product img{width:100%;height:120px;object-fit:cover}
.cart-count{background:red;color:white;padding:2px 6px;border-radius:50%}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center}
.modal-content{background:white;padding:20px;border-radius:8px;width:90%;max-width:500px;max-height:90%;overflow:auto}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
th{background:#009688;color:white}
input{width:100%;padding:6px;margin-bottom:10px}
</style>
</head>

<body>

<header>
<h2>BELLI ET BIEN ÊTRE</h2>
<button onclick="openCart()">Panier (<span id="count">0</span>)</button>
</header>

<div class="products" id="products"></div>

<!-- PANIER -->
<div class="modal" id="cartModal">
<div class="modal-content">
<h3>Votre Panier</h3>
<table>
<thead>
<tr><th>Produit</th><th>Qté</th><th>Total</th><th>X</th></tr>
</thead>
<tbody id="cartBody"></tbody>
</table>
<button onclick="openForm()">Valider commande</button>
<button onclick="closeCart()">Fermer</button>
</div>
</div>

<!-- FORMULAIRE -->
<div class="modal" id="formModal">
<div class="modal-content">
<h3>Informations Client</h3>
<form id="orderForm">
<input type="text" id="nom" placeholder="Nom" required>
<input type="text" id="prenom" placeholder="Prénom" required>
<input type="text" id="adresse" placeholder="Adresse" required>
<input type="tel" id="telephone" placeholder="Téléphone" required>
<input type="date" id="dateCommande" readonly>
<input type="date" id="dateLivraison" readonly>
<button type="submit">Générer Facture</button>
</form>
<button onclick="closeForm()">Fermer</button>
</div>
</div>

<script>

const produits = [
{id:1, nom:"Huile Naturelle", prix:15},
{id:2, nom:"Savon Bio", prix:8},
{id:3, nom:"Crème Hydratante", prix:20}
];

let cart = [];

const container = document.getElementById("products");
produits.forEach(p=>{
container.innerHTML += `
<div class="product">
<h4>${p.nom}</h4>
<p>${p.prix} €</p>
<button onclick="addToCart(${p.id})">Ajouter</button>
</div>`;
});

function addToCart(id){
let item = cart.find(p=>p.id===id);
if(item){item.quantite++}
else{
let prod = produits.find(p=>p.id===id);
cart.push({...prod, quantite:1});
}
updateCart();
}

function updateCart(){
document.getElementById("count").innerText = cart.reduce((a,b)=>a+b.quantite,0);
const body = document.getElementById("cartBody");
body.innerHTML="";
cart.forEach((p,i)=>{
body.innerHTML += `
<tr>
<td>${p.nom}</td>
<td>${p.quantite}</td>
<td>${(p.prix*p.quantite).toFixed(2)}</td>
<td><button onclick="removeItem(${i})">X</button></td>
</tr>`;
});
}

function removeItem(i){
cart.splice(i,1);
updateCart();
}

function openCart(){document.getElementById("cartModal").style.display="flex";}
function closeCart(){document.getElementById("cartModal").style.display="none";}

function openForm(){
if(cart.length===0){alert("Panier vide !");return;}
closeCart();
document.getElementById("formModal").style.display="flex";

const today=new Date();
document.getElementById("dateCommande").value=today.toISOString().split("T")[0];

let livraison=new Date();
livraison.setDate(today.getDate()+3);
document.getElementById("dateLivraison").value=livraison.toISOString().split("T")[0];
}

function closeForm(){document.getElementById("formModal").style.display="none";}

function sauvegarderCommande(data){
let commandes=JSON.parse(localStorage.getItem("commandes"))||[];
commandes.push(data);
localStorage.setItem("commandes",JSON.stringify(commandes));
}

document.getElementById("orderForm").addEventListener("submit",function(e){
e.preventDefault();

const nom=document.getElementById("nom").value;
const prenom=document.getElementById("prenom").value;
const adresse=document.getElementById("adresse").value;
const telephone=document.getElementById("telephone").value;
const dateCommande=document.getElementById("dateCommande").value;
const dateLivraison=document.getElementById("dateLivraison").value;

const numero="FAC-"+dateCommande.replaceAll("-","")+"-"+Math.floor(Math.random()*10000);

const total=cart.reduce((a,b)=>a+b.prix*b.quantite,0);

sauvegarderCommande({
numeroFacture:numero,
client:nom+" "+prenom,
telephone,
adresse,
dateCommande,
dateLivraison,
total
});

const {jsPDF}=window.jspdf;
const doc=new jsPDF();

doc.setFontSize(18);
doc.text("BELLI ET BIEN ÊTRE",20,20);
doc.setFontSize(11);
doc.text("Adresse : Dakar, Sénégal",20,28);
doc.text("Téléphone : +221 77 000 00 00",20,34);
doc.text("Facture : "+numero,20,45);

doc.autoTable({
startY:55,
head:[["Produit","Quantité","Prix","Total"]],
body:cart.map(p=>[
p.nom,
p.quantite,
p.prix,
(p.prix*p.quantite).toFixed(2)
])
});

doc.text("TOTAL : "+total.toFixed(2)+" €",150,doc.lastAutoTable.finalY+10);

doc.save("facture_"+numero+".pdf");

cart=[];
updateCart();
closeForm();
alert("Commande enregistrée !");
});

</script>
</body>
</html>
